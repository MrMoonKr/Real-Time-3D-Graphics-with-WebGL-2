<html>

<head>
    <title>Real-Time 3D Graphics with WebGL2</title>
    <link rel="shortcut icon" type="image/png" href="/common/images/favicon.png" />

    <!-- libraries -->
    <link rel="stylesheet" href="/common/lib/normalize.css">
    <!-- <script type="text/javascript" src="/common/lib/dat.gui.js"></script>
    <script type="text/javascript" src="/common/lib/gl-matrix.js"></script> -->

    <!-- modules -->
    <!-- <script type="text/javascript" src="/common/js/utils.js"></script>
    <script type="text/javascript" src="/common/js/EventEmitter.js"></script>
    <script type="text/javascript" src="/common/js/Camera.js"></script>
    <script type="text/javascript" src="/common/js/Clock.js"></script>
    <script type="text/javascript" src="/common/js/Controls.js"></script>
    <script type="text/javascript" src="/common/js/Floor.js"></script>
    <script type="text/javascript" src="/common/js/Light.js"></script>
    <script type="text/javascript" src="/common/js/Program.js"></script>
    <script type="text/javascript" src="/common/js/Picker.js"></script>
    <script type="text/javascript" src="/common/js/Scene.js"></script>
    <script type="text/javascript" src="/common/js/Transforms.js"></script> -->

    <script id="vertex-shader" type="x-shader/x-vertex">
        #version 300 es
        precision mediump float;

        uniform mat4 uModelViewMatrix;
        uniform mat4 uProjectionMatrix;
        uniform mat4 uNormalMatrix;
        uniform vec3 uLightPosition;
        uniform vec4 uMaterialDiffuse;
        uniform bool uWireframe;

        in vec3 aVertexPosition;
        in vec3 aVertexNormal;
        in vec4 aVertexColor;

        out vec3 vNormal;
        out vec3 vLightRay;
        out vec3 vEyeVector;
        out vec4 vFinalColor;

        void main(void) 
        {
            vFinalColor = uMaterialDiffuse;

            vec4 vertex = uModelViewMatrix * vec4(aVertexPosition, 1.0);
            vNormal = vec3(uNormalMatrix * vec4(aVertexNormal, 1.0));

            vec4 light = vec4(uLightPosition,1.0);
            vLightRay = vertex.xyz-light.xyz;
            vEyeVector = -vec3(vertex.xyz);

            gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(aVertexPosition, 1.0);
        }
    </script>

    <script id="fragment-shader" type="x-shader/x-fragment">
        #version 300 es
        precision mediump float;

        uniform bool uWireframe;
        uniform vec4 uLightAmbient;
        uniform vec4 uLightDiffuse;
        uniform vec4 uMaterialAmbient;
        uniform vec4 uMaterialDiffuse;
        uniform vec4 uPickingColor;
        uniform bool uOffscreen;

        in vec3 vNormal;
        in vec3 vLightRay;
        in vec3 vEyeVector;
        in vec4 vFinalColor;

        out vec4 fragColor;

        void main(void) 
        {
            if (uOffscreen) {
                fragColor = uPickingColor;
                return;
            }

            if (uWireframe) {
                fragColor = vFinalColor;
            }
            else {
                // Ambient
                vec4 Ia = uLightAmbient * uMaterialAmbient;

                // Diffuse
                vec3 L = normalize(vLightRay);
                vec3 N = normalize(vNormal);
                float lambertTerm = max(dot(N, -L), 0.33);
                vec4 Id = uLightDiffuse * uMaterialDiffuse * lambertTerm;

                // Specular
                vec3 E = normalize(vEyeVector);
                vec3 R = reflect(L, N);
                float specular = pow( max(dot(R, E), 0.5), 50.0);
                vec4 Is = vec4(0.5) * specular;

                vec4 finalColor = Ia + Id + Is;

                if (uMaterialDiffuse.a != 1.0) {
                finalColor.a = uMaterialDiffuse.a;
                }
                else {
                finalColor.a = 1.0;
                }

                fragColor = finalColor;
            }
        }
    </script>

    <script type="text/javascript" src="../dist/ch08_04_picking_final.bundle.js"></script>
</head>

<body>

    <canvas id="webgl-canvas">
        Your browser does not support the HTML5 canvas element.
    </canvas>

</body>

</html>